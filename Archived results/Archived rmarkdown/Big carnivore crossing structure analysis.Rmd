---
title: "Big carnivore crossing structure analysis"
output: pdf_document
---

# Script to run GLMM to look at the temporal variation in big carnivore use of underpasses and jumpouts We first separate out the day/season/annual counts by structure type and explore the influence of time of day (crep/day/night) for the day counts, season for the season counts and year for the annual counts. We also explore the influence of vehicles and humans. For all daily/seasonal underpass models only the day/season parameter is explored as the sample size for these models is too small to sample more parameters. The traffic varible is dropped from all models as it was extremely collinear with the day/season/year parameter.

# Model structure: count (per structure) ~ crep/day/night or season + traffic volume + human use +
# Location + random = sampling effort

```{r, echo=FALSE, include=FALSE}
rm(list = ls())

#-----------------Set working directory--------------------
setwd("/Users/hannahedwards/Documents/Alberta Parks/Crossing-structures/data/")

#----------------Load libraries----------------------------
library(MCMCglmm)

#----------------Load datasets----------------------------

bigcarnivores.day <- read.csv("Bigcarnivores hourly daynight.csv")
bigcarnivores.season <- read.csv("Bigcarnivores seasonal.csv")
bigcarnivores.annual <- read.csv("Bigcarnivores annual.csv")

#Separate out by crossing structure type
#Did not run for big carnivore jumpout sample size small use circular plots as evidence
bigcarnivores.day.under<-subset(bigcarnivores.day, bigcarnivores.day$Underpass.type != "Jumpout")
bigcarnivores.day.jump<-subset(bigcarnivores.day, bigcarnivores.day$Underpass.type != "Underpass")
bigcarnivores.season.under<-subset(bigcarnivores.season, bigcarnivores.season$Underpass.type != "Jumpout")
bigcarnivores.season.jump<-subset(bigcarnivores.season, bigcarnivores.season$Underpass.type != "Underpass")
bigcarnivores.annual.under<-subset(bigcarnivores.annual, bigcarnivores.annual$Underpass.type != "Jumpout")
bigcarnivores.annual.jump<-subset(bigcarnivores.annual, bigcarnivores.annual$Underpass.type != "Underpass")

# aim to store 1,000-2,000 iterations
# have the autocorrelation between successive stored iterations less than 0.1
# fixed effects: interesting in themselves
# random effects: only underlying population is of interest
```
## big daily carnivores
```{r, eval=TRUE, echo=TRUE}
prior<-list(R=list(V=1, nu=0.002), 
            G = list(G1 = list(V = 1, nu = 0.002)))

prioexp<- list(R = list(V = 1, nu=0.002), #residuals prior
               G = list(G1 = list(V = 1,nu= 0.02,alpha.mu=0,alpha.V=1000)))

```
## Underpass
```{r, eval=TRUE, echo=FALSE}
bigcarnivores.day.under$Location2<-as.factor(bigcarnivores.day.under$Location2)
bigcarnivores.day.under$daynight<-as.factor(bigcarnivores.day.under$daynight)

bigcarnivore.day.under <- MCMCglmm(Total ~
                                      daynight,
                                    random = ~ average.effort ,
                                    prior = prior, nitt=1003000, burnin=100000, thin=500,
                                    verbose = FALSE,
                                    family = "poisson",
                                    data = bigcarnivores.day.under)


bigcarnivore.day.under.exp <- MCMCglmm(Total ~
                                      daynight,
                                    random = ~ average.effort ,
                                    prior = prioexp, nitt=1003000, burnin=100000, thin=500,
                                    verbose = FALSE,
                                    family = "poisson",
                                    data = bigcarnivores.day.under)

#Summary stats
```
## model summary and plots of IG prior and expanded prior respectively
```{r, eval=TRUE, echo=FALSE}
summary(bigcarnivore.day.under)
summary(bigcarnivore.day.under.exp)
plot(bigcarnivore.day.under)
plot(bigcarnivore.day.under.exp)
```
## Jumpout
```{r, eval=TRUE, echo=FALSE}
bigcarnivores.day.jump$Location2<-as.factor(bigcarnivores.day.jump$Location2)
bigcarnivores.day.jump$daynight<-as.factor(bigcarnivores.day.jump$daynight)

bigcarnivore.day.jump <- MCMCglmm(Total ~
                                      daynight + Location2 +
                                      daynight.human,
                                    random = ~ average.effort ,
                                    prior = prior, nitt=1003000, burnin=100000, thin=500,
                                    verbose = FALSE,
                                    family = "poisson",
                                    data = bigcarnivores.day.jump)


bigcarnivore.day.jump.exp <- MCMCglmm(Total ~
                                          daynight + Location2 +
                                          daynight.human,
                                        random = ~ average.effort ,
                                        prior = prioexp, nitt=1003000, burnin=100000, thin=500,
                                        verbose = FALSE,
                                        family = "poisson",
                                        data = bigcarnivores.day.jump)


```
## model summary and plots of IG prior and expanded prior respectively
```{r, eval=TRUE, echo=FALSE}
summary(bigcarnivore.day.jump)
summary(bigcarnivore.day.jump.exp)
plot(bigcarnivore.day.jump)
plot(bigcarnivore.day.jump.exp)
```
# big seasonal carnivores
## Underpass
```{r, eval=TRUE, echo=FALSE}
bigcarnivores.season.under$Location2<-as.factor(bigcarnivores.season.under$Location2)
bigcarnivores.season.under$Season<-as.factor(bigcarnivores.season.under$Season)


bigcarnivore.season.under <- MCMCglmm(Total ~
                                      Season,
                                    random = ~ average.effort ,
                                    prior = prior, nitt=1003000, burnin=100000, thin=500,
                                    verbose = FALSE,
                                    family = "poisson",
                                    data = bigcarnivores.season.under)


bigcarnivore.season.under.exp <- MCMCglmm(Total ~
                                          Season,
                                        random = ~ average.effort ,
                                        prior = prioexp, nitt=1003000, burnin=100000, thin=500,
                                        verbose = FALSE,
                                        family = "poisson",
                                        data = bigcarnivores.season.under)

```
## model summary and plots of IG prior and expanded prior respectively
```{r, eval=TRUE, echo=FALSE}
par(mar = rep(2, 4))
summary(bigcarnivore.season.under)
summary(bigcarnivore.season.under.exp)
plot(bigcarnivore.season.under)
plot(bigcarnivore.season.under.exp)
```
## Jumpouts
```{r, eval=TRUE, echo=FALSE}
bigcarnivores.season.jump$Location2<-as.factor(bigcarnivores.season.jump$Location2)
bigcarnivores.season.jump$Season<-as.factor(bigcarnivores.season.jump$Season)


bigcarnivore.season.jump <- MCMCglmm(Total ~
                                         Season + Location2 +
                                         seasonal.human,
                                       random = ~ average.effort ,
                                       prior = prior, nitt=1003000, burnin=100000, thin=500,
                                       verbose = FALSE,
                                       family = "poisson",
                                       data = bigcarnivores.season.jump)


bigcarnivore.season.jump.exp <- MCMCglmm(Total ~
                                             Season + Location2 +
                                             seasonal.human,
                                           random = ~ average.effort ,
                                           prior = prioexp, nitt=1003000, burnin=100000, thin=500,
                                           verbose = FALSE,
                                           family = "poisson",
                                           data = bigcarnivores.season.jump)


```
## model summary and plots of IG prior and expanded prior respectively
```{r, eval=TRUE, echo=FALSE}
summary(bigcarnivore.season.jump)
summary(bigcarnivore.season.jump.exp)
plot(bigcarnivore.season.jump)
plot(bigcarnivore.season.jump.exp)
```
# big annual carnivores
## Underpass
```{r, eval=TRUE, echo=FALSE}
bigcarnivores.annual.under$Location2<-as.factor(bigcarnivores.annual.under$Location2)

bigcarnivore.annual.under <- MCMCglmm(Total ~
                                         Year + Location2 +
                                         annual.human,
                                       random = ~ annual.effort ,
                                       prior = prior, nitt=1003000, burnin=100000, thin=500,
                                       verbose = FALSE,
                                       family = "poisson",
                                       data = bigcarnivores.annual.under)


bigcarnivore.annual.under.exp <- MCMCglmm(Total ~
                                              Year + Location2 +
                                             annual.human,
                                           random = ~ annual.effort ,
                                           prior = prioexp, nitt=1003000, burnin=100000, thin=500,
                                           verbose = FALSE,
                                           family = "poisson",
                                           data = bigcarnivores.annual.under)


```
## model summary and plots of IG prior and expanded prior respectively
```{r, eval=TRUE, echo=FALSE}
par(mar = rep(2, 4))
summary(bigcarnivore.annual.under)
summary(bigcarnivore.annual.under.exp)
plot(bigcarnivore.annual.under)
plot(bigcarnivore.annual.under.exp)
```
## Jumpouts
```{r, eval=TRUE, echo=FALSE}
bigcarnivores.annual.jump$Location2<-as.factor(bigcarnivores.annual.jump$Location2)

bigcarnivore.annual.jump <- MCMCglmm(Total ~
                                         Year + Location2 +
                                         annual.human,
                                       random = ~ annual.effort ,
                                       prior = prior, nitt=1003000, burnin=100000, thin=500,
                                       verbose = FALSE,
                                       family = "poisson",
                                       data = bigcarnivores.annual.jump)


bigcarnivore.annual.jump.exp <- MCMCglmm(Total ~
                                             Year + Location2 +
                                             annual.human,
                                           random = ~ annual.effort ,
                                           prior = prioexp, nitt=1003000, burnin=100000, thin=500,
                                           verbose = FALSE,
                                           family = "poisson",
                                           data = bigcarnivores.annual.jump)


```
## model summary and plots of IG prior and expanded prior respectively
```{r, eval=TRUE, echo=FALSE}
par(mar = rep(2, 4))
summary(bigcarnivore.annual.jump)
summary(bigcarnivore.annual.jump.exp)
plot(bigcarnivore.annual.jump)
plot(bigcarnivore.annual.jump.exp)
```