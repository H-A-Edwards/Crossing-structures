---
title: "Small carnivore crossing structure analysis"
output: pdf_document
---

# Script to run GLMM to look at the temporal variation in small carnivore use of underpasses and jumpouts We first separate out the day/season/annual counts by structure type and explore the influence of time of day (crep/day/night) for the day counts, season for the season counts and year for the annual counts. We also explore the influence of vehicles and humans. For all daily/seasonal underpass models only the day/season parameter is explored as the sample size for these models is too small to sample more parameters. The traffic varible is dropped from all models as it was extremely collinear with the day/season/year parameter.

# Model structure: count (per structure) ~ crep/day/night or season + traffic volume + human use +
# Location + random = sampling effort

```{r, echo=FALSE, include=FALSE}
rm(list = ls())

#-----------------Set working directory--------------------
setwd("/Users/hannahedwards/Documents/Alberta Parks/Crossing-structures/data/")

#----------------Load libraries----------------------------
library(MCMCglmm)

#----------------Load datasets----------------------------
smallcarnivores.day <- read.csv("Smallcarnivores hourly daynight.csv")
smallcarnivores.season <- read.csv("Smallcarnivores seasonal.csv")
smallcarnivores.annual <- read.csv("Smallcarnivores annual.csv")

#Separate out by crossing structure type
smallcarnivores.day.under<-subset(smallcarnivores.day, smallcarnivores.day$Underpass.type != "Jumpout")
smallcarnivores.day.jump<-subset(smallcarnivores.day, smallcarnivores.day$Underpass.type != "Underpass")
smallcarnivores.season.under<-subset(smallcarnivores.season, smallcarnivores.season$Underpass.type != "Jumpout")
smallcarnivores.season.jump<-subset(smallcarnivores.season, smallcarnivores.season$Underpass.type != "Underpass")
smallcarnivores.annual.under<-subset(smallcarnivores.annual, smallcarnivores.annual$Underpass.type != "Jumpout")
smallcarnivores.annual.jump<-subset(smallcarnivores.annual, smallcarnivores.annual$Underpass.type != "Underpass")

# aim to store 1,000-2,000 iterations
# have the autocorrelation between successive stored iterations less than 0.1
# fixed effects: interesting in themselves
# random effects: only underlying population is of interest
```
## Small daily carnivores
```{r, eval=TRUE, echo=TRUE}
prior<-list(R=list(V=1, nu=0.002), 
            G = list(G1 = list(V = 1, nu = 0.002)))

prioexp<- list(R = list(V = 1, nu=0.002), #residuals prior
               G = list(G1 = list(V = 1,nu= 0.02,alpha.mu=0,alpha.V=1000)))

```
## Underpass
```{r, eval=TRUE, echo=FALSE}
smallcarnivores.day.under$Location2<-as.factor(smallcarnivores.day.under$Location2)
smallcarnivores.day.under$daynight<-as.factor(smallcarnivores.day.under$daynight)

smallcarnivore.day.under <- MCMCglmm(Total ~
                                      daynight,
                                    random = ~ average.effort ,
                                    prior = prior, nitt=1003000, burnin=100000, thin=500,
                                    verbose = FALSE,
                                    family = "poisson",
                                    data = smallcarnivores.day.under)


smallcarnivore.day.under.exp <- MCMCglmm(Total ~
                                      daynight,
                                    random = ~ average.effort ,
                                    prior = prioexp, nitt=1003000, burnin=100000, thin=500,
                                    verbose = FALSE,
                                    family = "poisson",
                                    data = smallcarnivores.day.under)

#Summary stats
```
## model summary and plots of IG prior and expanded prior respectively
```{r, eval=TRUE, echo=FALSE}
summary(smallcarnivore.day.under)
summary(smallcarnivore.day.under.exp)
plot(smallcarnivore.day.under)
plot(smallcarnivore.day.under.exp)
```
## Jumpout
```{r, eval=TRUE, echo=FALSE}
smallcarnivores.day.jump$Location2<-as.factor(smallcarnivores.day.jump$Location2)
smallcarnivores.day.jump$daynight<-as.factor(smallcarnivores.day.jump$daynight)

smallcarnivore.day.jump <- MCMCglmm(Total ~
                                      daynight + Location2 +
                                      daynight.human,
                                    random = ~ average.effort ,
                                    prior = prior, nitt=1003000, burnin=100000, thin=500,
                                    verbose = FALSE,
                                    family = "poisson",
                                    data = smallcarnivores.day.jump)


smallcarnivore.day.jump.exp <- MCMCglmm(Total ~
                                          daynight + Location2 +
                                          daynight.human,
                                        random = ~ average.effort ,
                                        prior = prioexp, nitt=1003000, burnin=100000, thin=500,
                                        verbose = FALSE,
                                        family = "poisson",
                                        data = smallcarnivores.day.jump)


```
## model summary and plots of IG prior and expanded prior respectively
```{r, eval=TRUE, echo=FALSE}
summary(smallcarnivore.day.jump)
summary(smallcarnivore.day.jump.exp)
plot(smallcarnivore.day.jump)
plot(smallcarnivore.day.jump.exp)
```
# Small seasonal carnivores
## Underpass
```{r, eval=TRUE, echo=FALSE}
smallcarnivores.season.under$Location2<-as.factor(smallcarnivores.season.under$Location2)
smallcarnivores.season.under$Season<-as.factor(smallcarnivores.season.under$Season)


smallcarnivore.season.under <- MCMCglmm(Total ~
                                      Season,
                                    random = ~ average.effort ,
                                    prior = prior, nitt=1003000, burnin=100000, thin=500,
                                    verbose = FALSE,
                                    family = "poisson",
                                    data = smallcarnivores.season.under)


smallcarnivore.season.under.exp <- MCMCglmm(Total ~
                                          Season,
                                        random = ~ average.effort ,
                                        prior = prioexp, nitt=1003000, burnin=100000, thin=500,
                                        verbose = FALSE,
                                        family = "poisson",
                                        data = smallcarnivores.season.under)

```
## model summary and plots of IG prior and expanded prior respectively
```{r, eval=TRUE, echo=FALSE}
par(mar = rep(2, 4))
summary(smallcarnivore.season.under)
summary(smallcarnivore.season.under.exp)
plot(smallcarnivore.season.under)
plot(smallcarnivore.season.under.exp)
```
## Jumpouts
```{r, eval=TRUE, echo=FALSE}
smallcarnivores.season.jump$Location2<-as.factor(smallcarnivores.season.jump$Location2)
smallcarnivores.season.jump$Season<-as.factor(smallcarnivores.season.jump$Season)


smallcarnivore.season.jump <- MCMCglmm(Total ~
                                         Season + Location2 +
                                         seasonal.human,
                                       random = ~ average.effort ,
                                       prior = prior, nitt=1003000, burnin=100000, thin=500,
                                       verbose = FALSE,
                                       family = "poisson",
                                       data = smallcarnivores.season.jump)


smallcarnivore.season.jump.exp <- MCMCglmm(Total ~
                                             Season + Location2 +
                                             seasonal.human,
                                           random = ~ average.effort ,
                                           prior = prioexp, nitt=1003000, burnin=100000, thin=500,
                                           verbose = FALSE,
                                           family = "poisson",
                                           data = smallcarnivores.season.jump)


```
## model summary and plots of IG prior and expanded prior respectively
```{r, eval=TRUE, echo=FALSE}
summary(smallcarnivore.season.jump)
summary(smallcarnivore.season.jump.exp)
plot(smallcarnivore.season.jump)
plot(smallcarnivore.season.jump.exp)
```
# Small annual carnivores
## Underpass
```{r, eval=TRUE, echo=FALSE}
smallcarnivores.annual.under$Location2<-as.factor(smallcarnivores.annual.under$Location2)

smallcarnivore.annual.under <- MCMCglmm(Total ~
                                         Year + Location2 +
                                         annual.human,
                                       random = ~ annual.effort ,
                                       prior = prior, nitt=1003000, burnin=100000, thin=500,
                                       verbose = FALSE,
                                       family = "poisson",
                                       data = smallcarnivores.annual.under)


smallcarnivore.annual.under.exp <- MCMCglmm(Total ~
                                              Year + Location2 +
                                             annual.human,
                                           random = ~ annual.effort ,
                                           prior = prioexp, nitt=1003000, burnin=100000, thin=500,
                                           verbose = FALSE,
                                           family = "poisson",
                                           data = smallcarnivores.annual.under)


```
## model summary and plots of IG prior and expanded prior respectively
```{r, eval=TRUE, echo=FALSE}
par(mar = rep(2, 4))
summary(smallcarnivore.annual.under)
summary(smallcarnivore.annual.under.exp)
plot(smallcarnivore.annual.under)
plot(smallcarnivore.annual.under.exp)
```
## Jumpouts
```{r, eval=TRUE, echo=FALSE}
smallcarnivores.annual.jump$Location2<-as.factor(smallcarnivores.annual.jump$Location2)

smallcarnivore.annual.jump <- MCMCglmm(Total ~
                                         Year + Location2 +
                                         annual.human,
                                       random = ~ annual.effort ,
                                       prior = prior, nitt=1003000, burnin=100000, thin=500,
                                       verbose = FALSE,
                                       family = "poisson",
                                       data = smallcarnivores.annual.jump)


smallcarnivore.annual.jump.exp <- MCMCglmm(Total ~
                                             Year + Location2 +
                                             annual.human,
                                           random = ~ annual.effort ,
                                           prior = prioexp, nitt=1003000, burnin=100000, thin=500,
                                           verbose = FALSE,
                                           family = "poisson",
                                           data = smallcarnivores.annual.jump)


```
## model summary and plots of IG prior and expanded prior respectively
```{r, eval=TRUE, echo=FALSE}
par(mar = rep(2, 4))
summary(smallcarnivore.annual.jump)
summary(smallcarnivore.annual.jump.exp)
plot(smallcarnivore.annual.jump)
plot(smallcarnivore.annual.jump.exp)
```